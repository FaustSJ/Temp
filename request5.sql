CREATE DATABASE IF NOT EXISTS GENDER_STATISTICS;

USE GENDER_STATISTICS;

CREATE EXTERNAL TABLE GENDER_STATS
(COUNTRY_NAME STRING, COUNTRY_CODE STRING, INDICATOR_NAME STRING, INDICATOR_CODE STRING,
Y1960 DOUBLE, Y1961 DOUBLE, Y1962 DOUBLE, Y1963 DOUBLE, Y1964 DOUBLE, Y1965 DOUBLE, Y1966 DOUBLE,
Y1967 DOUBLE, Y1968 DOUBLE, Y1969 DOUBLE, Y1970 DOUBLE, Y1971 DOUBLE, Y1972 DOUBLE, Y1973 DOUBLE,
Y1974 DOUBLE, Y1975 DOUBLE, Y1976 DOUBLE, Y1977 DOUBLE, Y1978 DOUBLE, Y1979 DOUBLE, Y1980 DOUBLE,
Y1981 DOUBLE, Y1982 DOUBLE, Y1983 DOUBLE, Y1984 DOUBLE, Y1985 DOUBLE, Y1986 DOUBLE, Y1987 DOUBLE,
Y1988 DOUBLE, Y1989 DOUBLE, Y1990 DOUBLE, Y1991 DOUBLE, Y1992 DOUBLE, Y1993 DOUBLE, Y1994 DOUBLE,
Y1995 DOUBLE, Y1996 DOUBLE, Y1997 DOUBLE, Y1998 DOUBLE, Y1999 DOUBLE, Y2000 DOUBLE, Y2001 DOUBLE,
Y2002 DOUBLE, Y2003 DOUBLE, Y2004 DOUBLE, Y2005 DOUBLE, Y2006 DOUBLE, Y2007 DOUBLE, Y2008 DOUBLE,
Y2009 DOUBLE, Y2010 DOUBLE, Y2011 DOUBLE, Y2012 DOUBLE, Y2013 DOUBLE, Y2014 DOUBLE, Y2015 DOUBLE,
Y2016 DOUBLE)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|';

LOAD DATA INPATH '/home/cloudera/LData/Gender_StatsData.csv' INTO TABLE GENDER_STATS;

CREATE TABLE QUESTION_5
SELECT * FROM GENDER_STATS 
WHERE INDICATOR_NAME = "School enrollment, tertiary (gross), gender parity index (GPI)"
AND 
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|';

ADD jar difference.jar
CREATE TEMPORARY FUNCTION difference AS 'com.revature.Difference';
CREATE TEMPORARY FUNCTION earliestyear AS 'com.revature.EarliestYear';
CREATE TEMPORARY FUNCTION latestyear AS 'com.revature.LatestYear';

CREATE TABLE QUESTION_5_OUTPUT
SELECT COUNTRY_NAME AS COUNTRY, 
ealiestyear(Y2010, Y2011, Y2012, Y2013, Y2014, Y2015, Y2016) AS EARLIESTYEAR,
latestyear(Y2010, Y2011, Y2012, Y2013, Y2014, Y2015, Y2016) AS LATESTYEAR,
difference(Y2010, Y2011, Y2012, Y2013, Y2014, Y2015, Y2016) AS IMPROVEMENT
FROM QUESTION_5
WHERE EARLIESTYEAR NOT NULL
AND LATESTYEAR NOT NULL
AND DIFFERENCE NOT NULL
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|';
